<%= form_for(@orcamento, html: { class: "form-horizontal", role: "form" }) do |f| %>
  <% if @orcamento.errors.any? %>
    <div class="alert alert-danger alert-dismissable" role="alert">
      <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
      <h4>Confira os campos abaixo:</h4>

      <ul>
      <% @orcamento.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="ibox-content">
    <div class="form-group">
      <%= f.label :clientes, 'Cliente', class: "col-sm-1 control-label" %>
      <div class="col-sm-10">
        <%= f.select :cliente_id, Cliente.all.reorder("nome asc").collect { |cliente| ["#{cliente.nome} - #{cliente.bairro}", cliente.id] }, {:selected => @orcamento.cliente_id, :include_blank => true}, {:class=> 'form-control', :onclick=>"informarCliente()"} %>
      </div>
    </div>

    <div class="row form-group">
      <label>Cliente</label>
        <%= f.select :cliente_id, Cliente.all.reorder("nome asc").collect { |cliente| ["#{cliente.nome} - #{cliente.bairro}", cliente.id] }, {:selected => @orcamento.cliente_id, :include_blank => true}, {:class=> 'form-control', :onclick=>"informarCliente()"} %>
      </div>
    </div>  

    <div class="row form-group">
      <div class="col-md-12">
        <label>Natureza de Operação</label>
        <input class="form-control" type="text" id="natureza_operacao" disabled>
      </div>
    </div>
    
    <div class="row form-group input-cliente" style="display:none;">
        <div class="col-md-12">
          <%= f.label :cliente, 'Cliente' %>
          <%= f.select :cliente_id, Cliente.all.reorder("nome asc").collect { |cliente| [cliente.nome, cliente.id] }, {:selected => @orcamento.cliente_id, :include_blank => true}, {:class=> 'form-control'} %>
        </div>
    </div>       
  
    <div class="row form-group">
        <div class="col-md-2">
          <%= f.label :data_emissao, 'Data Emissão' %>
          <%= f.date_field :data_emissao, class: "form-control" %>
        </div>
    </div>   
  </div>
  
  <div class="form-group">
    <div class="col-sm-10">
      <%= f.submit "Salvar", class: "btn btn-primary" %>
    </div>
  </div>
<% end %>

<script>
//Bloqueia a tecla Enter no campo de Input
$(document).ready(function() {
  $(window).keydown(function(event){
    if(event.keyCode == 13) {
      event.preventDefault();
      return false;
    }
  });

  buscaCfop()
});

const informarCliente = () =>{
  let cliente_id = $("#orcamento_cliente_id").val()
  $("#id_cliente").val(`${cliente_id}`); 
}

const buscaCfop = () => {
  let cfop_id = $("#nota_fiscal_cfop_id").val() 

  $.ajax({
    type: "GET",
    url: `/cfop/${cfop_id}.json`,
    success: function(cfop){
      if(cfop){       
        $('#natureza_operacao').val(cfop.natureza_operacao);
        if(cfop.cliente_fornecedor_cf == "C"){
          $(".input-cliente").show()
          $(".input-fornecedor").hide()
        }else{
          $(".input-cliente").hide()
          $(".input-fornecedor").show()
        }
      }
    }
  })
}

</script>